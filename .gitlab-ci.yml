stages:
  - build

build:
  image: almalinux:9
  stage: build
  script:
    - dnf install -y epel-release
    - dnf install -y git-core rpm-build rpmdevtools
    - mkdir -p rpmbuild/{BUILD,RPMS,SOURCES,SPECS,SRPMS}
    - spectool -g zookeeper.spec
    - dnf builddep -y zookeeper.spec
    - rpmbuild --define "_topdir $(pwd)/rpmbuild" --define "_sourcedir $(pwd)" --define "_srcrpmdir $(pwd)" -bs --nodeps zookeeper.spec
    - rpmbuild --define "_topdir $(pwd)/rpmbuild" --define "_sourcedir $(pwd)" --define "_srcrpmdir $(pwd)" --rebuild *.src.rpm
    - echo "Build completed"
  artifacts:
    paths:
      - rpmbuild/RPMS/noarch/*.rpm
    expire_in: 1 week